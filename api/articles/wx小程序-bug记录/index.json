{"title":"wx小程序 bug记录","uid":"c6ed01f79789c67a9afc63759dd9592c","slug":"wx小程序-bug记录/index","date":"2022-07-29T16:00:00.000Z","updated":"2023-04-07T03:57:31.569Z","comments":true,"path":"api/articles/wx小程序-bug记录/index.json","keywords":null,"cover":[],"content":"<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意！</p>\n<p>遇到所有问题，先在真机跑一下，说不定好了</p>\n</div>\n<h3 id=\"微信小程序webview两次返回问题\"><a href=\"#微信小程序webview两次返回问题\" class=\"headerlink\" title=\"微信小程序webview两次返回问题\"></a>微信小程序<code>webview</code>两次返回问题</h3><h4 id=\"1-下载SDK文件\"><a href=\"#1-下载SDK文件\" class=\"headerlink\" title=\"1.下载SDK文件\"></a>1.下载<code>SDK</code>文件</h4><p><a href=\"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#3\">概述 | 微信开放文档 (qq.com</a></p>\n<h4 id=\"2-在H5页面中引入SDK文件\"><a href=\"#2-在H5页面中引入SDK文件\" class=\"headerlink\" title=\"2.在H5页面中引入SDK文件\"></a>2.在H5页面中引入SDK文件</h4><p>加入如下逻辑即可</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">mounted() &#123;\n    history.pushState(&#123;page: 1&#125;, null, window.location.href);\n    &#x2F;&#x2F;然后监听popstate事件\n    window.addEventListener(&#39;popstate&#39;, (event) &#x3D;&gt; &#123;\n        wx.miniProgram.navigateBack();\n    &#125;);\n&#125;</code></pre>\n\n<h3 id=\"background-size不生效\"><a href=\"#background-size不生效\" class=\"headerlink\" title=\"background-size不生效\"></a><code>background-size</code>不生效</h3><pre class=\"line-numbers language-css\" data-language=\"css\"><code class=\"language-css\">view &#123;\n    background: url(&#39;xxx.png&#39;) no-repeat;\n    background-size: 100% 100%;\n&#125;</code></pre>\n<p>如此写法时，<code>background-size</code>不会生效，要使用<code>background-image</code>属性声明背景图片</p>\n<pre class=\"line-numbers language-css\" data-language=\"css\"><code class=\"language-css\">view &#123;\n    background-image: url(&#39;xxx.png&#39;);\n    background-repeat: no-repeat;\n    background-size: 100% 100%;\n&#125;</code></pre>\n\n<h3 id=\"Echarts不显示\"><a href=\"#Echarts不显示\" class=\"headerlink\" title=\"Echarts不显示\"></a><code>Echarts</code>不显示</h3><p>使用<code>Echarts</code>绘制<code>canvas</code>时，必须给其父级盒子声明宽高，并且此<code>view</code>中不能拥有其他挤占宽高的元素</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;view class&#x3D;&quot;chart-box&quot;&gt;\n\t&lt;ec-canvas ...&gt;&lt;&#x2F;ec-canvas&gt;\n&lt;&#x2F;view&gt;</code></pre>\n<pre class=\"line-numbers language-css\" data-language=\"css\"><code class=\"language-css\">.chart-box &#123;\n    width: 100rpx;\n    height: 100rpx;\n&#125;</code></pre>\n\n<h3 id=\"Echarts层级问题\"><a href=\"#Echarts层级问题\" class=\"headerlink\" title=\"Echarts层级问题\"></a><code>Echarts</code>层级问题</h3><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p>首先确认：打开手机扫码确认问题在真机也会同时出现</p>\n</div>\n<p>使用<code>canvas</code>时，层级会自动置于最高，解决办法：给canvas元素增加属性<code>type=&quot;2d&quot;</code><br>Echarts文档中写明，如不配置<code>force-use-old-canvas=&quot;true&quot;</code>的情况下，只要用户的基础库版本 &gt;&#x3D; 2.9.0，会自动为其中的<code>canvas</code>添加该属性，但效果显示并非如此<br>通过翻看源码查到，如果添加<code>isUseNewCanvas</code>，会使用新版<code>canvas</code>，但结果也并非如此，于是尝试更改源码，将其中的<code>ec-canvas.js</code>文件中的<code>data.isUseNewCanvas</code>改为<code>true</code>得以解决</p>\n<p><img src=\"/image/bug/wx/image-20220714152533617.png\" alt=\"image-20220714152533617\"></p>\n<h3 id=\"给组件使用hidden属性时失效\"><a href=\"#给组件使用hidden属性时失效\" class=\"headerlink\" title=\"给组件使用hidden属性时失效\"></a>给组件使用<code>hidden</code>属性时失效</h3><p>组件的<code>hidden</code>显示要使用<code>view</code>套一层，控制外层<code>view</code>的<code>hidden</code></p>\n<h3 id=\"引入字体\"><a href=\"#引入字体\" class=\"headerlink\" title=\"引入字体\"></a>引入字体</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx.loadFontFace(&#123;\n    family: &#39;zhenyan&#39;,\n    source: &quot;url(&#39;https:&#x2F;&#x2F;xxx&#x2F;zhenyan.ttf&#39;)&quot;,\n    global: true\n&#125;)</code></pre>\n\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意</p>\n<p><code>scopes: native</code>配置后<code>wxss</code>文件中会失效<br><code>app.js</code>文件中引用无效</p>\n</div>\n<h3 id=\"小程序canvas绘制\"><a href=\"#小程序canvas绘制\" class=\"headerlink\" title=\"小程序canvas绘制\"></a>小程序<code>canvas</code>绘制</h3><p>最新版本和web语法一致，但<code>ctx</code>对象需要如下操作</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">let query &#x3D; wx.createSelectorQuery().in(this);\nquery.select(&#39;#canvas&#39;).fields(&#123;\n    node: true,\n    size: true\n&#125;).exec(resp &#x3D;&gt; &#123;\n    const width &#x3D; resp[0].width;\n    const height &#x3D; resp[0].height;\n    let canvas &#x3D; resp[0].node;\n    let ctx &#x3D; canvas.getContext(&#39;2d&#39;);\n    let dpr &#x3D; wx.getSystemInfoSync().pixelRatio;\n    canvas.width &#x3D; width * dpr;\n    canvas.height &#x3D; height * dpr;\n\n    &#x2F;&#x2F; 绘制逻辑\n&#125;);</code></pre>\n\n<h3 id=\"wx-getUserProfile-接口调用不报错直接进入fail\"><a href=\"#wx-getUserProfile-接口调用不报错直接进入fail\" class=\"headerlink\" title=\"wx.getUserProfile()接口调用不报错直接进入fail\"></a><code>wx.getUserProfile()</code>接口调用不报错直接进入<code>fail</code></h3><p><code>desc</code>属性必填，且不可过长</p>\n<h3 id=\"vant组件引入后不生效\"><a href=\"#vant组件引入后不生效\" class=\"headerlink\" title=\"vant组件引入后不生效\"></a><code>vant</code>组件引入后不生效</h3><p>尝试重启编译器，引入未使用过的组件，第一次渲染不会生效</p>\n<h3 id=\"背景图片时而可以用静态地址，时而不行\"><a href=\"#背景图片时而可以用静态地址，时而不行\" class=\"headerlink\" title=\"背景图片时而可以用静态地址，时而不行\"></a>背景图片时而可以用静态地址，时而不行</h3><p>经测试，怀疑是过大的图片文件不可以用静态地址<br>解决方式：换用<code>image</code>元素做背景</p>\n","text":" 注意！ 遇到所有问题，先在真机跑一下，说不定好了 微信小程序webview两次返回问题1.下载SDK文件概述 | 微信开放文档 (qq.com 2.在H5页面中引入SDK文件加入如下逻辑即可 mounted() &#123; history.pushState(&#123;pa...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"bug","slug":"bug","count":6,"path":"api/categories/bug.json"}],"tags":[{"name":"bug","slug":"bug","count":6,"path":"api/tags/bug.json"},{"name":"wx小程序","slug":"wx小程序","count":1,"path":"api/tags/wx小程序.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8Fwebview%E4%B8%A4%E6%AC%A1%E8%BF%94%E5%9B%9E%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">微信小程序webview两次返回问题</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-%E4%B8%8B%E8%BD%BDSDK%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">1.下载SDK文件</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-%E5%9C%A8H5%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%BC%95%E5%85%A5SDK%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">2.在H5页面中引入SDK文件</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#background-size%E4%B8%8D%E7%94%9F%E6%95%88\"><span class=\"toc-text\">background-size不生效</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Echarts%E4%B8%8D%E6%98%BE%E7%A4%BA\"><span class=\"toc-text\">Echarts不显示</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Echarts%E5%B1%82%E7%BA%A7%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">Echarts层级问题</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BB%99%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8hidden%E5%B1%9E%E6%80%A7%E6%97%B6%E5%A4%B1%E6%95%88\"><span class=\"toc-text\">给组件使用hidden属性时失效</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BC%95%E5%85%A5%E5%AD%97%E4%BD%93\"><span class=\"toc-text\">引入字体</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E7%A8%8B%E5%BA%8Fcanvas%E7%BB%98%E5%88%B6\"><span class=\"toc-text\">小程序canvas绘制</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#wx-getUserProfile-%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E4%B8%8D%E6%8A%A5%E9%94%99%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5fail\"><span class=\"toc-text\">wx.getUserProfile()接口调用不报错直接进入fail</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#vant%E7%BB%84%E4%BB%B6%E5%BC%95%E5%85%A5%E5%90%8E%E4%B8%8D%E7%94%9F%E6%95%88\"><span class=\"toc-text\">vant组件引入后不生效</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87%E6%97%B6%E8%80%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E9%9D%99%E6%80%81%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%97%B6%E8%80%8C%E4%B8%8D%E8%A1%8C\"><span class=\"toc-text\">背景图片时而可以用静态地址，时而不行</span></a></li></ol>","author":{"name":"Life Experiencer","slug":"blog-author","avatar":"https://meng160626.github.io/charts/assets/headshot.cf6ae831.jpg","link":"/","description":"【开始努力最好的时机，就是当下】QQ:1350257855      微信:meng000414","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"使用VS Code开发uni-app","uid":"859c08d30a5499f1a412de01ef363b3c","slug":"使用VSCode开发uni-app/index","date":"2022-08-02T16:00:00.000Z","updated":"2023-04-06T06:24:17.717Z","comments":true,"path":"api/articles/使用VSCode开发uni-app/index.json","keywords":null,"cover":null,"text":"Project info 编辑器：VS Code框架：uni-app Project create 使用npm搭配vue-cli $ vue create -p dcloudio&#x2F;uni-preset-vue &#39;project name&#39; Project...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"环境搭建及配置","slug":"环境搭建及配置","count":4,"path":"api/categories/环境搭建及配置.json"}],"tags":[{"name":"环境搭建及配置","slug":"环境搭建及配置","count":2,"path":"api/tags/环境搭建及配置.json"},{"name":"uni-app","slug":"uni-app","count":2,"path":"api/tags/uni-app.json"},{"name":"VS Code","slug":"VS-Code","count":1,"path":"api/tags/VS-Code.json"}],"author":{"name":"Life Experiencer","slug":"blog-author","avatar":"https://meng160626.github.io/charts/assets/headshot.cf6ae831.jpg","link":"/","description":"【开始努力最好的时机，就是当下】QQ:1350257855      微信:meng000414","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"前端压缩","uid":"77f748c7cea4ef5fb4d783ef512007b4","slug":"前端压缩/index","date":"2022-07-01T16:00:00.000Z","updated":"2023-04-07T05:36:31.932Z","comments":true,"path":"api/articles/前端压缩/index.json","keywords":null,"cover":null,"text":"1.引入JSZip&lt;script src&#x3D;&quot;jszip.js&quot;&gt;&lt;&#x2F;script&gt; &lt;script src&#x3D;&quot;jszip-utils.js&quot;&gt;&lt;&#x2F;script...","link":"","photos":[],"count_time":{"symbolsCount":"3.9k","symbolsTime":"4 mins."},"categories":[{"name":"工具类","slug":"工具类","count":3,"path":"api/categories/工具类.json"}],"tags":[{"name":"压缩","slug":"压缩","count":1,"path":"api/tags/压缩.json"}],"author":{"name":"Life Experiencer","slug":"blog-author","avatar":"https://meng160626.github.io/charts/assets/headshot.cf6ae831.jpg","link":"/","description":"【开始努力最好的时机，就是当下】QQ:1350257855      微信:meng000414","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}