{"title":"前端导出","uid":"ee1781b2ca281272a7524c04a8bacf0a","slug":"前端导出/index","date":"2022-07-01T16:00:00.000Z","updated":"2023-04-07T05:45:19.156Z","comments":true,"path":"api/articles/前端导出/index.json","keywords":null,"cover":null,"content":"<h3 id=\"1-引入工具类\"><a href=\"#1-引入工具类\" class=\"headerlink\" title=\"1.引入工具类\"></a>1.引入工具类</h3><pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;script lang&#x3D;&quot;javascript&quot; src&#x3D;&quot;https:&#x2F;&#x2F;cdn.sheetjs.com&#x2F;xlsx-0.18.7&#x2F;package&#x2F;dist&#x2F;xlsx.full.min.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre>\n\n<p>(官方文档)[<a href=\"https://github.com/SheetJS/sheetjs]\">https://github.com/SheetJS/sheetjs]</a></p>\n<h3 id=\"2-封装导出\"><a href=\"#2-封装导出\" class=\"headerlink\" title=\"2.封装导出\"></a>2.封装导出</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; 导出按钮点击事件\nfunction onExportClick(dataSrc) &#123;\n    var listdata &#x3D; dataSrc;\n    var typeList &#x3D; [];  &#x2F;&#x2F; 记录录入的类型\n    var tableData &#x3D; [];&#x2F;&#x2F;表格数据\n    var titleRow &#x3D; [&quot;突发事件处置表&quot;]; &#x2F;&#x2F; 标题行\n    var secondRow &#x3D; [&quot;日期&quot;];\n    var thirdRow &#x3D; [&quot;&quot;];\n    var data &#x3D; [];\n    \n    listdata.forEach(item &#x3D;&gt; &#123;\n        if (secondRow.indexOf(item.EventParentTypeName) &#x3D;&#x3D; -1) &#123;\n            secondRow.push(item.EventParentTypeName, &quot;&quot;);\n            typeList.push(item.EventParentTypeId);\n        &#125;\n    &#125;);\n    \n    secondRow.push(&quot;发布情报板（条）&quot;);\n    \n    for (var i &#x3D; 0; i &lt; typeList.length; i++) &#123;\n        thirdRow.push(&quot;次数&quot;, &quot;时长(min)&quot;);\n    &#125;\n    thirdRow.push(&quot;&quot;);\n    tableData.push(titleRow, secondRow, thirdRow);\n    \n    &#x2F;&#x2F; 组装数据成对象数组\n    var dataObjList &#x3D; [];\n    listdata.forEach(item &#x3D;&gt; &#123;\n        var time &#x3D; item.EventReportDate;\n        time +&#x3D; item.Shift &#x3D;&#x3D; 1 ? &quot;（白班）&quot; : &quot;（夜班）&quot;;\n        var index &#x3D; dataObjList.findIndex(e &#x3D;&gt; e.time &#x3D;&#x3D; time);\n        if (index &#x3D;&#x3D; -1) &#123;\n            dataObjList.push(&#123;\n                time,\n                count: item.InfoBoardNumber,\n                list: [&#123;\n                    times: item.EventNumber,\n                    duration: item.Duration,\n                    id: item.EventParentTypeId\n                &#125;]\n            &#125;);\n        &#125; else &#123;\n            dataObjList[index].count +&#x3D; item.InfoBoardNumber;\n            dataObjList[index].list.push(&#123;\n                times: item.EventNumber,\n                duration: item.Duration,\n                id: item.EventParentTypeId\n            &#125;);\n        &#125;\n    &#125;);\n    &#x2F;&#x2F; 将对象数组转为对应格式\n    dataObjList.forEach(item &#x3D;&gt; &#123;\n        data.push(item.time);\n        typeList.forEach(id &#x3D;&gt; &#123;\n            var index &#x3D; item.list.findIndex(e &#x3D;&gt; e.id &#x3D;&#x3D; id);\n            if (index &#x3D;&#x3D; -1) &#123;\n                data.push(&quot;&quot;, &quot;&quot;);\n            &#125; else &#123;\n                data.push(item.list[index].times, item.list[index].duration);\n            &#125;\n        &#125;);\n        data.push(item.count);\n        tableData.push(data);\n        data &#x3D; [];\n    &#125;);\n    \n    var sheet &#x3D; XLSX.utils.aoa_to_sheet(tableData, &#123; raw: true &#125;);\n    &#x2F;&#x2F; 配置跨行跨列\n    merge &#x3D; [\n        &#123; \n            s: &#123; r: 0, c: 0 &#125;, \n            e: &#123; r: 0, c: secondRow.length &#125; \n        &#125;,\n        &#123;\n            s: &#123; r: 1, c: 0&#125;,\n            e: &#123; r: 2, c: 0&#125;\n        &#125;\n    ];\n    for (var i &#x3D; 0; i &lt; typeList.length; i++) &#123;\n        merge.push(\n            &#123;\n                s: &#123; r: 1, c: 2 * i + 1&#125;,\n                e: &#123; r: 1, c: 2 * i + 2&#125;\n            &#125;\n        );\n    &#125;\n    sheet[&#39;!merges&#39;] &#x3D; merge;\n    saveAs(sheet2blob(sheet), &#39;突发事件处置表&#39; + formatDate(new Date(), &quot;yyyy-MM-dd&quot;) + &#39;.xlsx&#39;);\n&#125;\n\n&#x2F;&#x2F; 导出表格\nfunction saveAs(blob, filename) &#123;\n    if (window.navigator.msSaveOrOpenBlob) &#123;\n        navigator.msSaveBlob(blob, filename);\n    &#125; else &#123;\n        var link &#x3D; document.createElement(&#39;a&#39;);\n        var body &#x3D; document.querySelector(&#39;body&#39;);\n\n        link.href &#x3D; window.URL.createObjectURL(blob);\n        link.download &#x3D; filename;\n\n        &#x2F;&#x2F; fix Firefox\n        link.style.display &#x3D; &#39;none&#39;;\n        body.appendChild(link);\n\n        link.click();\n        body.removeChild(link);\n\n        window.URL.revokeObjectURL(link.href);\n    &#125;;\n&#125;\n\nfunction sheet2blob(sheet, sheetName) &#123;\n    sheetName &#x3D; sheetName || &#39;sheet1&#39;;\n    var workbook &#x3D; &#123;\n        SheetNames: [sheetName],\n        Sheets: &#123;&#125;\n    &#125;;\n    workbook.Sheets[sheetName] &#x3D; sheet;\n    &#x2F;&#x2F; 生成excel的配置项\n    var wopts &#x3D; &#123;\n        bookType: &#39;xlsx&#39;, &#x2F;&#x2F; 要生成的文件类型\n        bookSST: false, &#x2F;&#x2F; 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性\n        type: &#39;binary&#39;\n    &#125;;\n    var wbout &#x3D; XLSX.write(workbook, wopts);\n    var blob &#x3D; new Blob([s2ab(wbout)], &#123; type: &quot;application&#x2F;octet-stream&quot; &#125;);\n    &#x2F;&#x2F; 字符串转ArrayBuffer\n    function s2ab(s) &#123;\n        var buf &#x3D; new ArrayBuffer(s.length);\n        var view &#x3D; new Uint8Array(buf);\n        for (var i &#x3D; 0; i !&#x3D; s.length; ++i) view[i] &#x3D; s.charCodeAt(i) &amp; 0xFF;\n        return buf;\n    &#125;\n    return blob;\n&#125;\n\n&#x2F;&#x2F;格式化日期,\nfunction formatDate(date, format) &#123;\n    var paddNum &#x3D; function (num) &#123;\n        num +&#x3D; &quot;&quot;;\n        return num.replace(&#x2F;^(\\d)$&#x2F;, &quot;0$1&quot;);\n    &#125;\n    &#x2F;&#x2F;指定格式字符\n    var cfg &#x3D; &#123;\n        yyyy: date.getFullYear() &#x2F;&#x2F;年 : 4位\n        , yy: date.getFullYear().toString().substring(2)&#x2F;&#x2F;年 : 2位\n        , M: date.getMonth() + 1  &#x2F;&#x2F;月 : 如果1位的时候不补0\n        , MM: paddNum(date.getMonth() + 1) &#x2F;&#x2F;月 : 如果1位的时候补0\n        , d: date.getDate()   &#x2F;&#x2F;日 : 如果1位的时候不补0\n        , dd: paddNum(date.getDate())&#x2F;&#x2F;日 : 如果1位的时候补0\n        , hh: date.getHours()  &#x2F;&#x2F;时\n        , mm: date.getMinutes() &#x2F;&#x2F;分\n        , ss: date.getSeconds() &#x2F;&#x2F;秒\n    &#125;\n    format || (format &#x3D; &quot;yyyy-MM-dd hh:mm:ss&quot;);\n    return format.replace(&#x2F;([a-z])(\\1)*&#x2F;ig, function (m) &#123; return cfg[m]; &#125;);\n&#125;</code></pre>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p>原场景中的dataSrc如下</p>\n</div>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">\n&#x2F;&#x2F; 原始数据 （原场景为ajax请求获取到的数据）\nvar dataSrc &#x3D; [\n    &#123;\n        &quot;Shift&quot;: 1,\n        &quot;EventReportDate&quot;: &quot;2022-04-25&quot;,\n        &quot;EventParentTypeId&quot;: 12,\n        &quot;EventParentTypeName&quot;: &quot;测试事件&quot;,\n        &quot;EventNumber&quot;: 5,\n        &quot;Duration&quot;: 0.0,\n        &quot;InfoBoardNumber&quot;: 0\n    &#125;,\n    &#123;\n        &quot;Shift&quot;: 1,\n        &quot;EventReportDate&quot;: &quot;2022-04-26&quot;,\n        &quot;EventParentTypeId&quot;: 12,\n        &quot;EventParentTypeName&quot;: &quot;测试事件&quot;,\n        &quot;EventNumber&quot;: 3,\n        &quot;Duration&quot;: 0.0,\n        &quot;InfoBoardNumber&quot;: 0\n    &#125;,\n    &#123;\n        &quot;Shift&quot;: 1,\n        &quot;EventReportDate&quot;: &quot;2022-04-27&quot;,\n        &quot;EventParentTypeId&quot;: 12,\n        &quot;EventParentTypeName&quot;: &quot;测试事件&quot;,\n        &quot;EventNumber&quot;: 4,\n        &quot;Duration&quot;: 0.0,\n        &quot;InfoBoardNumber&quot;: 0\n    &#125;,\n    &#123;\n        &quot;Shift&quot;: 2,\n        &quot;EventReportDate&quot;: &quot;2022-04-27&quot;,\n        &quot;EventParentTypeId&quot;: 12,\n        &quot;EventParentTypeName&quot;: &quot;测试事件&quot;,\n        &quot;EventNumber&quot;: 2,\n        &quot;Duration&quot;: 0.0,\n        &quot;InfoBoardNumber&quot;: 0\n    &#125;,\n    &#123;\n        &quot;Shift&quot;: 1,\n        &quot;EventReportDate&quot;: &quot;2022-04-29&quot;,\n        &quot;EventParentTypeId&quot;: 1,\n        &quot;EventParentTypeName&quot;: &quot;天气事件&quot;,\n        &quot;EventNumber&quot;: 8,\n        &quot;Duration&quot;: 33001.634283333333,\n        &quot;InfoBoardNumber&quot;: 4\n    &#125;\n];</code></pre>","text":"1.引入工具类&lt;script lang&#x3D;&quot;javascript&quot; src&#x3D;&quot;https:&#x2F;&#x2F;cdn.sheetjs.com&#x2F;xlsx-0.18.7&#x2F;package&#x2F;dist&...","link":"","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[{"name":"工具类","slug":"工具类","count":2,"path":"api/categories/工具类.json"}],"tags":[{"name":"导出","slug":"导出","count":1,"path":"api/tags/导出.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E5%BC%95%E5%85%A5%E5%B7%A5%E5%85%B7%E7%B1%BB\"><span class=\"toc-text\">1.引入工具类</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E5%B0%81%E8%A3%85%E5%AF%BC%E5%87%BA\"><span class=\"toc-text\">2.封装导出</span></a></li></ol>","author":{"name":"Life Experiencer","slug":"blog-author","avatar":"https://meng160626.github.io/charts/assets/headshot.cf6ae831.jpg","link":"/","description":"【开始努力最好的时机，就是当下】QQ:1350257855      微信:meng000414","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"wx小程序 bug记录","uid":"c6ed01f79789c67a9afc63759dd9592c","slug":"wx小程序-bug记录/index","date":"2022-07-29T16:00:00.000Z","updated":"2023-04-07T03:57:31.569Z","comments":true,"path":"api/articles/wx小程序-bug记录/index.json","keywords":null,"cover":[],"text":" 注意！ 遇到所有问题，先在真机跑一下，说不定好了 微信小程序webview两次返回问题1.下载SDK文件概述 | 微信开放文档 (qq.com 2.在H5页面中引入SDK文件加入如下逻辑即可 mounted() &#123; history.pushState(&#123;pa...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"bug","slug":"bug","count":6,"path":"api/categories/bug.json"}],"tags":[{"name":"bug","slug":"bug","count":6,"path":"api/tags/bug.json"},{"name":"wx小程序","slug":"wx小程序","count":1,"path":"api/tags/wx小程序.json"}],"author":{"name":"Life Experiencer","slug":"blog-author","avatar":"https://meng160626.github.io/charts/assets/headshot.cf6ae831.jpg","link":"/","description":"【开始努力最好的时机，就是当下】QQ:1350257855      微信:meng000414","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"前端压缩","uid":"77f748c7cea4ef5fb4d783ef512007b4","slug":"前端压缩/index","date":"2022-07-01T16:00:00.000Z","updated":"2023-04-07T05:36:31.932Z","comments":true,"path":"api/articles/前端压缩/index.json","keywords":null,"cover":null,"text":"1.引入JSZip&lt;script src&#x3D;&quot;jszip.js&quot;&gt;&lt;&#x2F;script&gt; &lt;script src&#x3D;&quot;jszip-utils.js&quot;&gt;&lt;&#x2F;script...","link":"","photos":[],"count_time":{"symbolsCount":"3.9k","symbolsTime":"4 mins."},"categories":[{"name":"工具类","slug":"工具类","count":2,"path":"api/categories/工具类.json"}],"tags":[{"name":"压缩","slug":"压缩","count":1,"path":"api/tags/压缩.json"}],"author":{"name":"Life Experiencer","slug":"blog-author","avatar":"https://meng160626.github.io/charts/assets/headshot.cf6ae831.jpg","link":"/","description":"【开始努力最好的时机，就是当下】QQ:1350257855      微信:meng000414","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}